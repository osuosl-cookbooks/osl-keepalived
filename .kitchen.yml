---
provisioner:
  name: chef_solo
  encrypted_data_bag_secret_key_path: test/integration/encrypted_data_bag_secret
  data_bags_path: test/integration/data_bags

verifier: inspec

suites:
  - name: default
    run_list:
      - recipe[osl-keepalived::default]
  - name: haproxy_osuosl
    run_list:
      - recipe[keepalived_test::haproxy_test]
      - recipe[keepalived_test::hostname]
      - recipe[osl-keepalived::haproxy_osuosl]
    attributes:
      osl-keepalived:
         haproxy:
            interface: 'eth1'
      keepalived_test:
        fqdn: lb1.osuosl.org
        eth1:
          ipv4: 140.211.9.50/24
          ipv6: 2605:bc80:3010:104::8cd3:935/64
  - name: haproxy_phpbb
    run_list:
      - recipe[keepalived_test::haproxy_test]
      - recipe[keepalived_test::hostname]
      - recipe[osl-keepalived::haproxy_phpbb]
    attributes:
      osl-keepalived:
         haproxy:
            interface: 'eth1'
      keepalived_test:
        fqdn: lb1.phpbb.org
        eth1:
          ipv4: 140.211.9.50/24
          ipv6: 2605:bc80:3010:104::8cd3:935/64
  - name: mysql2
    run_list:
      - recipe[keepalived_test::mysql_test]
      - recipe[keepalived_test::hostname]
      - recipe[osl-keepalived::mysql2]
    attributes:
      osl-keepalived:
         haproxy:
            interface: 'eth2'
      keepalived_test:
        fqdn: mysql3.osuosl.org
        eth1:
          ipv4: 140.211.9.50/24
        eth2:
          ipv4: 140.211.9.50/24
  - name: multi-node-7
    driver:
      name: terraform
      command_timeout: 1800
    excludes:
      - centos-8
    provisioner: terraform
    verifier:
      name: terraform
      systems:
        - name: node1
          backend: ssh
          hosts_output: node1
          sudo: true
          user: centos
          controls:
            - all
            - node1
          hostnames: node1
        - name: node2
          backend: ssh
          hosts_output: node2
          sudo: true
          user: centos
          controls:
            - all
            - node2
          hostnames: node2
  - name: multi-node-8
    driver:
      name: terraform
      command_timeout: 1800
      variables:
        centos_image: "CentOS 8.1"
    excludes:
      - centos-7
    provisioner: terraform
    verifier:
      name: terraform
      systems:
        - name: node1
          backend: ssh
          hosts_output: node1
          sudo: true
          user: centos
          controls:
            - all
            - node1
          hostnames: node1
        - name: node2
          backend: ssh
          hosts_output: node2
          sudo: true
          user: centos
          controls:
            - all
            - node2
          hostnames: node2
